@@
   try {
     // existing dev-login logic ...
   } catch (e) {
-    return res.status(500).json({ ok: false, error: 'internal_error' });
+    const body = { ok: false, error: 'internal_error' };
+    if (process.env.NODE_ENV !== 'production') {
+      try { body.detail = String(e?.message || e); } catch (_) {}
+    }
+    return res.status(500).json(body);
   }
 });
 
+// Quick auth visibility: shows parsed cookies, auth header, and req.user (if any)
+app.get('/__whoami', (req, res) => {
+  try {
+    const raw = req.headers.cookie || '';
+    const cookies = req.cookies || (
+      globalThis.__cg_parseCookiesFromHeader__
+        ? globalThis.__cg_parseCookiesFromHeader__(raw)
+        : {}
+    );
+    return res.json({
+      ok: true,
+      have_user: !!req.user,
+      user: req.user || null,
+      auth_header: req.headers.authorization || null,
+      cookies,
+      raw_cookie: raw || null
+    });
+  } catch (e) {
+    return res.status(500).json({ ok:false, error:'whoami_failed', detail: String(e?.message || e) });
+  }
+});
+
 // Route map (diagnostics):
 app.get('/__routes', (req, res) => {

